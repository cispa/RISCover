#!/usr/bin/env python3
import argparse

from pyutils.shared_logic import parse_and_set_flags
parse_and_set_flags()

from pyutils.shared_logic import parser_add_common_extension_parsing, get_collection_from_args, get_most_common_argparser

parser = get_most_common_argparser()
parser.add_argument('instr', type=str)
parser.add_argument('change', nargs='*', help='Specify wanted changes in the form "Rd=10"')

parser.add_argument('--vector', action='store_true')
parser.add_argument('--floats', action='store_true')

parser_add_common_extension_parsing(parser)
args = parser.parse_args()
collection = get_collection_from_args(args)

i = collection.assemble_static_fields(args.instr)
for c in args.change:
    name, value = c.split('=')
    i = collection.instr_set_encoding(i, name, int(value, 0), mnemonic=args.instr)
print("New instruction:", hex(i))
collection.pretty_print_instr(i)
