#!/usr/bin/env python3
import sys
import capstone

from pyutils.shared_logic import parse_and_set_flags, get_most_common_argparser
parse_and_set_flags()

import pyutils.config as config

parser = get_most_common_argparser()
parser.add_argument('instr', type=lambda x: int(x, 16), nargs='+')
args = parser.parse_args()

match config.ARCH:
    case "riscv64":
        md = capstone.Cs(capstone.CS_ARCH_RISCV, capstone.CS_MODE_RISCV64|capstone.CS_MODE_RISCVC)
    case "aarch64":
        md = capstone.Cs(capstone.CS_ARCH_ARM64, capstone.CS_MODE_ARM)

first = True
for instr in args.instr:
    if not first:
        print()
    first = False
    print(f"{instr:08x}:")
    for i in md.disasm(instr.to_bytes(4, byteorder='little'), 0):
        print("%s\t%s" % (i.mnemonic, i.op_str))
